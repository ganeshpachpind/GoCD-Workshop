<!-- Multistage pipeline stage -->

<pipelines group="defaultGroup">
    <pipeline name="FirstPipeline">
      <materials>
        <git url="https://github.com/ganeshpachpind/goWorkshop.git" materialName="GOWorkshop" />
      </materials>
      <stage name="ListFiles">
        <jobs>
          <job name="List">
            <tasks>
              <exec command="ls" />
            </tasks>
            <artifacts>
              <artifact src="*" dest="goWorkshop" />
            </artifacts>
          </job>
        </jobs>
      </stage>
    </pipeline>
    <pipeline name="ExecutePython">
      <materials>
        <pipeline pipelineName="FirstPipeline" stageName="ListFiles" />
      </materials>
      <stage name="Execute">
        <jobs>
          <job name="Run">
            <tasks>
              <fetchartifact pipeline="FirstPipeline" stage="ListFiles" job="List" srcdir="goWorkshop">
                <runif status="passed" />
              </fetchartifact>
              <exec command="/bin/bash" workingdir="goWorkshop">
                <arg>-c</arg>
                <arg>python create_file.python</arg>
                <runif status="passed" />
              </exec>
            </tasks>
            <artifacts>
              <artifact src="*" dest="goWorkshop" />
            </artifacts>
          </job>
        </jobs>
      </stage>
    </pipeline>
    <pipeline name="List_AfterFiles">
      <materials>
        <pipeline pipelineName="ExecutePython" stageName="Execute" />
      </materials>
      <stage name="List_After">
        <jobs>
          <job name="List_after_details">
            <tasks>
              <fetchartifact pipeline="ExecutePython" stage="Execute" job="Run" srcdir="goWorkshop">
                <runif status="passed" />
              </fetchartifact>
              <exec command="/bin/bash" workingdir="goWorkshop">
                <arg>-c</arg>
                <arg>ls</arg>
                <runif status="passed" />
              </exec>
            </tasks>
          </job>
        </jobs>
      </stage>
    </pipeline>
    <pipeline name="ListAllFiles">
      <materials>
        <pipeline pipelineName="ExecutePython" stageName="Execute" />
      </materials>
      <stage name="ListAll">
        <jobs>
          <job name="ListAll">
            <tasks>
              <fetchartifact pipeline="ExecutePython" stage="Execute" job="Run" srcdir="goWorkshop">
                <runif status="passed" />
              </fetchartifact>
              <exec command="/bin/bash" workingdir="goWorkshop">
                <arg>-c</arg>
                <arg>ls -la</arg>
                <runif status="passed" />
              </exec>
            </tasks>
          </job>
        </jobs>
      </stage>
      <stage name="Sleep">
        <jobs>
          <job name="Sleep">
            <tasks>
              <fetchartifact pipeline="ExecutePython" stage="Execute" job="Run" srcdir="goWorkshop">
                <runif status="passed" />
              </fetchartifact>
              <exec command="/bin/bash" workingdir="goWorkshop">
                <arg>-c</arg>
                <arg>sleep 60</arg>
              </exec>
            </tasks>
          </job>
        </jobs>
      </stage>
      <stage name="PrintWorkingDir">
        <jobs>
          <job name="WorkingDir">
            <tasks>
              <fetchartifact pipeline="ExecutePython" stage="Execute" job="Run" srcdir="goWorkshop">
                <runif status="passed" />
              </fetchartifact>
              <exec command="/bin/bash" workingdir="goWorkshop">
                <arg>-c</arg>
                <arg>pwd</arg>
              </exec>
            </tasks>
          </job>
        </jobs>
      </stage>
    </pipeline>
  </pipelines>
